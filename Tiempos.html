<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TIEMPO DE AGENTES</title>
<style>
  :root{
    --bg:#0b0f14;
    --panel:#111826;
    --accent:#00d2ff;
    --ok:#28c76f;
    --warn:#ffcc00;
    --danger:#ff4d4f;
    --muted:#8aa0b3;
    --chip:#162233;
    --chip2:#13314a;
    --white:#eaf1f6;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial;
    background: radial-gradient(1200px 700px at 20% -10%, #0e1828, #0b0f14 60%) fixed;
    color:var(--white);
  }

  /* Header */
  .topbar{
    position:sticky; top:0; z-index:5;
    backdrop-filter: blur(10px);
    background: linear-gradient(180deg, rgba(11,15,20,.9), rgba(11,15,20,.6));
    border-bottom:1px solid #1f2b3a;
    padding:14px 18px;
    display:flex; gap:16px; align-items:center; justify-content:space-between; flex-wrap:wrap;
  }
  .title{font-weight:700; letter-spacing:.3px; font-size: clamp(18px, 2vw, 22px)}
  .badges{display:flex; gap:10px; flex-wrap:wrap}
  .badge{
    background:var(--chip);
    color:var(--muted);
    padding:8px 12px; border-radius:999px; display:flex; align-items:center; gap:8px;
    border:1px solid #203247; font-size:13px;
  }
  .dot{width:8px; height:8px; border-radius:50%}
  .dot.ok{background:var(--ok)}
  .dot.busy{background:var(--warn)}
  .help{color:var(--muted); font-size:12px}

  /* Grid */
  .grid{
    display:grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap:16px;
    padding:18px;
    max-width:1400px; margin:0 auto;
  }

  /* Card */
  .card{
    background: linear-gradient(180deg, #111826, #0f1521 60%);
    border:1px solid #1f2b3a;
    border-radius:16px;
    padding:14px;
    box-shadow: 0 10px 20px rgba(0,0,0,.3), inset 0 1px 0 rgba(255,255,255,.02);
    position:relative; overflow:hidden;
    transition:transform .2s ease, box-shadow .2s ease, border-color .2s ease;
  }
  .card:hover{ transform: translateY(-2px); box-shadow: 0 14px 26px rgba(0,0,0,.35) }
  .name{
    font-weight:800;
    letter-spacing:.3px;
    margin-bottom:8px;
    font-size:18px;
  }
  .state{
    display:inline-flex; gap:8px; align-items:center;
    background:linear-gradient(180deg,#08212e,#051820);
    border:1px solid #123149;
    color:#a5d7ff; font-weight:700;
    padding:6px 10px; border-radius:999px; font-size:12px;
  }
  .rows{margin-top:10px; display:grid; gap:8px}
  .row{
    display:flex; align-items:center; justify-content:space-between;
    background:var(--chip2); border:1px solid #1b2e43; color:#9ab3c8;
    padding:8px 10px; border-radius:12px;
  }
  .row strong{color:#cde5ff; font-weight:700}
  .row .time{
    font-variant-numeric: tabular-nums;
    font-weight:700; color:#e8f4ff;
  }

  /* Buttons */
  .actions{ display:flex; gap:8px; margin-top:10px }
  .btn{
    flex:1; cursor:pointer; border:none;
    background:linear-gradient(180deg,#0c2b3c,#0a2230);
    color:#cfe9ff; padding:10px 12px; border-radius:12px;
    border:1px solid #1f3a51; font-weight:800;
    display:flex; align-items:center; justify-content:center; gap:8px;
    transition: filter .15s ease, transform .05s ease, border-color .2s ease;
  }
  .btn:active{ transform: scale(.98) }
  .btn[data-active="true"]{ 
    background:linear-gradient(180deg,#073e56,#072d41);
    border-color:#2e6b93; 
    color:#e7f6ff;
    box-shadow:0 0 0 2px rgba(0,210,255,.15) inset;
  }
  .btn.banio[data-active="true"]{ box-shadow:0 0 0 2px rgba(255,204,0,.18) inset }
  .btn.almuerzo[data-active="true"]{ box-shadow:0 0 0 2px rgba(0,210,255,.18) inset }

  /* Alert styles */
  .limit{ color:var(--warn) }
  .over{ color:var(--danger) }
  .pulse-danger{
    position:absolute; inset:-1px; border-radius:16px; pointer-events:none;
    box-shadow: 0 0 0 0 rgba(255,77,79,.35); animation: pulse 1.2s infinite;
  }
  @keyframes pulse{
    0%{ box-shadow: 0 0 0 0 rgba(255,77,79,.45) }
    70%{ box-shadow: 0 0 0 16px rgba(255,77,79,0) }
    100%{ box-shadow: 0 0 0 0 rgba(255,77,79,0) }
  }

  /* Footer help */
  footer{padding:8px 18px 24px; color:var(--muted); font-size:12px; text-align:center}
  code{background:#101826; border:1px solid #1e2b3a; padding:2px 6px; border-radius:6px; color:#bfe2ff}
</style>
</head>
<body>
  <header class="topbar">
    <div class="title">üïí CONTROL DE TIEMPOS CALL CENTER :)</div>
    <div class="badges">
      <div class="badge"><span class="dot ok"></span><span id="banioBadge">Ba√±o libre</span></div>
      <div class="badge"><span class="dot busy"></span> L√≠mite ba√±o: 15:00</div>
      <div class="badge"><span class="dot busy"></span> L√≠mite almuerzo: 60:00</div>
    </div>
    <div class="help">Tip: clic en <b>Ba√±o</b> o <b>Almuerzo</b> para iniciar / terminar.</div>
  </header>

  <main class="grid" id="grid"></main>

  <footer>
    Reglas: solo <b>un</b> agente puede estar en <b>ba√±o</b> simult√°neamente.
    Se reinicia autom√°ticamente a medianoche.  
    (Un solo archivo <code>.html</code>).
  </footer>

<script>
/* =================== Datos de agentes =================== */
const AGENTES = [
  "Pablo","Daniel","Andres","Rafael","Alejandro",
  "Jacky","Tania","Marta","Nestor","Sarai","Michi",
  "Evelyn","Merlin","Irene"
];

/* ====== Configuraci√≥n de l√≠mites (segundos) ====== */
const LIMITE_BANIO = 15 * 60;     // 15 minutos
const LIMITE_ALMUERZO = 60 * 60;  // 60 minutos

/* ====== Estado global ====== */
const estado = {}; // { nombre: {banio:{activo, inicio, transcurrido, alertado}, almuerzo:{...}} }
let usuarioEnBanio = null;        // nombre del agente que est√° en ba√±o (√∫nico)

/* ====== Utilidades ====== */
const $ = (sel, ctx=document) => ctx.querySelector(sel);
function fmt(seg) {
  seg = Math.max(0, Math.floor(seg));
  const m = Math.floor(seg/60).toString().padStart(2,'0');
  const s = (seg%60).toString().padStart(2,'0');
  return `${m}:${s}`;
}
function beep(){
  try{
    const ctx = new (window.AudioContext||window.webkitAudioContext)();
    const o = ctx.createOscillator(); const g = ctx.createGain();
    o.connect(g); g.connect(ctx.destination);
    o.type = "square"; o.frequency.setValueAtTime(880, ctx.currentTime);
    g.gain.setValueAtTime(0.08, ctx.currentTime);
    o.start(); g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+0.25);
    o.stop(ctx.currentTime+0.26);
    setTimeout(()=>ctx.close(),400);
  }catch(e){}
}

/* ====== Render ====== */
const grid = $("#grid");

function tarjetaHTML(nombre){
  return `
  <section class="card" data-user="${nombre}">
    <div class="name">${nombre}</div>
    <div class="state"><span>Estado:</span><span class="estado-text">Libre</span></div>

    <div class="rows">
      <div class="row">
        <span>üöª <strong>Ba√±o</strong></span>
        <span class="time" data-k="banio">00:00</span>
      </div>
      <div class="row">
        <span>üçΩÔ∏è <strong>Almuerzo</strong></span>
        <span class="time" data-k="almuerzo">00:00</span>
      </div>
    </div>

    <div class="actions">
      <button class="btn banio" data-k="banio" title="Iniciar/Terminar ba√±o">üöª Ba√±o</button>
      <button class="btn almuerzo" data-k="almuerzo" title="Iniciar/Terminar almuerzo">üçΩÔ∏è Almuerzo</button>
    </div>
    <div class="pulse-danger" hidden></div>
  </section>`;
}

function construirUI(){
  grid.innerHTML = AGENTES.map(tarjetaHTML).join("");
  AGENTES.forEach(nombre=>{
    estado[nombre] = {
      banio: {activo:false, inicio:0, transcurrido:0, alertado:false},
      almuerzo: {activo:false, inicio:0, transcurrido:0, alertado:false},
    };
  });

  grid.addEventListener("click", (ev)=>{
    const btn = ev.target.closest(".btn");
    if(!btn) return;
    const card = ev.target.closest(".card");
    const nombre = card.dataset.user;
    const tipo = btn.dataset.k; // "banio" o "almuerzo"
    toggle(nombre, tipo);
  });
}

/* ====== L√≥gica principal ====== */
function toggle(nombre, tipo){
  const reg = estado[nombre][tipo];

  // Reglas de exclusividad para ba√±o
  if(tipo==="banio"){
    if(!reg.activo && usuarioEnBanio && usuarioEnBanio!==nombre){
      alert(`‚ö†Ô∏è Solo una persona en ba√±o.\nActualmente: ${usuarioEnBanio}`);
      beep();
      return;
    }
  }

  reg.activo = !reg.activo;
  reg.alertado = false;
  if(reg.activo){
    reg.inicio = Date.now() - reg.transcurrido*1000; // reanudar si estaba pausado
    if(tipo==="banio") usuarioEnBanio = nombre;
  }else{
    reg.transcurrido = Math.floor((Date.now() - reg.inicio)/1000);
    if(tipo==="banio" && usuarioEnBanio===nombre) usuarioEnBanio = null;
  }
  pintar(nombre);
  actualizarBadgeBanio();
}

function actualizar(){
  const ahora = Date.now();
  for(const nombre of AGENTES){
    for(const tipo of ["banio","almuerzo"]){
      const reg = estado[nombre][tipo];
      if(reg.activo){
        reg.transcurrido = Math.floor((ahora - reg.inicio)/1000);
      }
    }
    pintar(nombre);
  }
}

function pintar(nombre){
  const card = grid.querySelector(`.card[data-user="${CSS.escape(nombre)}"]`);
  if(!card) return;

  const b = estado[nombre].banio;
  const a = estado[nombre].almuerzo;

  // tiempos
  card.querySelector('.time[data-k="banio"]').textContent = fmt(b.transcurrido);
  card.querySelector('.time[data-k="almuerzo"]').textContent = fmt(a.transcurrido);

  // estado principal
  const estadoTxt = card.querySelector(".estado-text");
  if(b.activo) estadoTxt.textContent = "En ba√±o";
  else if(a.activo) estadoTxt.textContent = "En almuerzo";
  else estadoTxt.textContent = "Libre";

  // botones activos
  const btnB = card.querySelector('.btn.banio');
  const btnA = card.querySelector('.btn.almuerzo');
  btnB.dataset.active = String(b.activo);
  btnA.dataset.active = String(a.activo);

  // color por l√≠mites
  const tb = card.querySelector('.time[data-k="banio"]');
  const ta = card.querySelector('.time[data-k="almuerzo"]');

  tb.classList.toggle('limit', b.transcurrido>=LIMITE_BANIO && b.transcurrido<LIMITE_BANIO+60);
  tb.classList.toggle('over',  b.transcurrido>=LIMITE_BANIO);
  ta.classList.toggle('limit', a.transcurrido>=LIMITE_ALMUERZO && a.transcurrido<LIMITE_ALMUERZO+60);
  ta.classList.toggle('over',  a.transcurrido>=LIMITE_ALMUERZO);

  // Anillo de pulso y alerta 1 sola vez
  const pulse = card.querySelector('.pulse-danger');
  if((b.transcurrido>=LIMITE_BANIO && b.activo) || (a.transcurrido>=LIMITE_ALMUERZO && a.activo)){
    pulse.hidden = false;
  }else{
    pulse.hidden = true;
  }

  // Disparar alerta una vez al pasarse (mensaje solicitado)
  if(b.activo && b.transcurrido===LIMITE_BANIO && !b.alertado){
    b.alertado = true;
    alert("ey you, estas te estas pasando de tiempo.");
    beep();
  }
  if(a.activo && a.transcurrido===LIMITE_ALMUERZO && !a.alertado){
    a.alertado = true;
    alert("ey you, estas te estas pasando de tiempo.");
    beep();
  }
}

function actualizarBadgeBanio(){
  const el = $("#banioBadge");
  el.textContent = usuarioEnBanio ? `Ba√±o ocupado por: ${usuarioEnBanio}` : "Ba√±o libre";
}

/* ====== Reinicio autom√°tico a medianoche ====== */
function resetDia(){
  AGENTES.forEach(nombre=>{
    const e = estado[nombre];
    e.banio = {activo:false,inicio:0,transcurrido:0,alertado:false};
    e.almuerzo = {activo:false,inicio:0,transcurrido:0,alertado:false};
    pintar(nombre);
  });
  usuarioEnBanio = null;
  actualizarBadgeBanio();
}

function programarReset(){
  const ahora = new Date();
  const manana = new Date(ahora);
  manana.setHours(24,0,0,0); // siguiente medianoche
  const ms = manana - ahora;
  setTimeout(()=>{
    resetDia();
    setInterval(resetDia, 24*60*60*1000); // luego cada 24h
  }, ms);
}

/* ====== Init ====== */
construirUI();
actualizarBadgeBanio();
setInterval(()=>{ try{ actualizar(); }catch(e){} }, 1000);
programarReset();
</script>
</body>
</html>
